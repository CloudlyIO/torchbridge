#!/bin/bash
#
# Git commit-msg hook to remove Claude Code footers
#
# This hook automatically removes any Claude-generated footers from commit messages:
# - "ðŸ¤– Generated with [Claude Code]..." lines
# - "Co-Authored-By: Claude Opus/Sonnet..." lines
# - "Generated with [Claude Code]..." lines (without emoji)
# - Trailing blank lines after removal
#
# Installation:
#   cp .githooks/commit-msg .git/hooks/commit-msg
#   chmod +x .git/hooks/commit-msg
#
# Or use: ./scripts/install-hooks.sh
#
# Created: 2025-12-26
# Version: 1.0
# Purpose: Ensure clean, professional commit messages

COMMIT_MSG_FILE=$1

# Create a temporary file
TEMP_FILE=$(mktemp)

# Process the commit message:
# 1. Remove lines containing Claude Code footer (with or without emoji)
# 2. Remove lines containing Co-Authored-By: Claude
# 3. Keep everything else
grep -v -E '(ðŸ¤– Generated with \[Claude Code\]|^Co-Authored-By: Claude (Opus|Sonnet)|^Generated with \[Claude Code\])' "$COMMIT_MSG_FILE" > "$TEMP_FILE"

# Remove trailing blank lines
sed -i '' -e :a -e '/^\s*$/{ $d; N; ba' -e '}' "$TEMP_FILE" 2>/dev/null || \
  perl -i -pe 'chomp if eof; s/\n+$/\n/ if eof' "$TEMP_FILE"

# Replace original with cleaned version
mv "$TEMP_FILE" "$COMMIT_MSG_FILE"

exit 0
